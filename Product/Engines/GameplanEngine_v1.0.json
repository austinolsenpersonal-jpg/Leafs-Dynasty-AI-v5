{
  "version": "1.0",
  "module": "Engines.GameplanEngine",
  "description": "Core gameplan engine for Leafs Dynasty Architect. Builds full matchup gameplans using NHL 25–legal Canon strategies and StrategyTrees (FiveOnFive, SpecialTeams, MatchupCard).",
  "meta": {
    "game": "NHL 25",
    "team": "Toronto Maple Leafs",
    "environment": "Leafs-Dynasty-AI-v5",
    "canon_dependencies": [
      "Product/Canon/Forecheck.json",
      "Product/Canon/NeutralZone.json",
      "Product/Canon/DefensivePressure.json",
      "Product/Canon/DefensiveStrategy.json",
      "Product/Canon/OffensiveStrategy.json",
      "Product/Canon/ControlBreakout.json",
      "Product/Canon/QuickBreakout.json",
      "Product/Canon/StrategyMap_v1.0.json",
      "Product/Canon/StrategyMap_v2.0.json"
    ],
    "strategy_tree_dependencies": [
      "Product/StrategyTrees/FiveOnFive_v1.0.json",
      "Product/StrategyTrees/SpecialTeams_v1.0.json",
      "Product/StrategyTrees/MatchupCard_v1.0.json"
    ]
  },
  "inputs": {
    "opponent_profile": {
      "required": [
        "team_abbrev",
        "team_name",
        "offense_style",
        "forecheck_tendency",
        "neutral_zone_tendency",
        "defense_style",
        "pp_style",
        "pk_style",
        "top_lines",
        "top_pair",
        "starting_goalie"
      ],
      "optional": [
        "rush_threats",
        "cycle_threats",
        "point_shot_threats",
        "goaltender_weaknesses",
        "recent_form_notes"
      ],
      "description": "High-level opponent snapshot used to pick Canon-approved counters."
    },
    "leafs_context": {
      "required": [
        "lines_nhl",
        "d_pairs",
        "pp_units",
        "pk_units"
      ],
      "optional": [
        "injuries",
        "fatigue_notes",
        "recent_form",
        "home_away"
      ],
      "description": "Current Leafs roster usage context, used to link tactics to real lines and pairs."
    },
    "environment_flags": {
      "fields": {
        "game_importance": "regular_season | rivalry | must_win | playoffs",
        "back_to_back": "none | first_half | second_half",
        "travel_fatigue": "low | medium | high",
        "score_bias": "neutral | protect_lead | chase_game"
      },
      "description": "Adjusts how aggressive or conservative the engine will be with tactics."
    }
  },
  "matchup_modes": {
    "standard": {
      "description": "Balanced gameplan. Uses Canon default counters without heavy bias.",
      "use_when": [
        "Regular season, non-rivalry",
        "No extreme opponent strength or weakness",
        "Form is stable on both sides"
      ]
    },
    "hybrid": {
      "description": "Blends protection and attack. Slight bias toward exploiting opponent weaknesses while keeping defensive structure.",
      "use_when": [
        "Opponent has clear weak D or shaky goalie",
        "Game is important but not full must-win",
        "You want control + opportunistic offense"
      ]
    },
    "shutdown": {
      "description": "Defense-first gameplan. Prioritizes neutral zone, slot protection and risk control.",
      "use_when": [
        "Playing elite offensive opponent",
        "Protecting key standings lead",
        "Leafs have fatigue or injuries on offense"
      ]
    },
    "attack": {
      "description": "High-pressure, high-forecheck plan. Uses full-attack Canon options where possible.",
      "use_when": [
        "Opponent has weak defense/goaltending",
        "Must-win game or chasing playoff race",
        "Leafs lines are healthy and in form"
      ]
    }
  },
  "section_schema": {
    "identity": {
      "fields": [
        "opponent_summary",
        "leafs_focus",
        "primary_objectives"
      ],
      "description": "One-paragraph identity snapshot for the matchup (who they are, how we plan to beat them)."
    },
    "systems_five_on_five": {
      "fields": [
        "forecheck",
        "neutral_zone",
        "trap_slider_0_to_6",
        "defensive_pressure",
        "defensive_strategy",
        "offensive_strategy",
        "control_breakout",
        "quick_breakout"
      ],
      "source": "Canon + FiveOnFive tree",
      "description": "NHL 25–legal 5v5 systems. Every field must map to a valid Canon option."
    },
    "line_usage": {
      "fields": [
        "preferred_matchups",
        "avoid_matchups",
        "oz_start_lines",
        "dz_start_lines",
        "neutral_zone_starts",
        "line_slider_notes"
      ],
      "description": "How to deploy each line vs specific opponent lines/pairs, plus slider emphasis by line."
    },
    "defense_pairs_usage": {
      "fields": [
        "preferred_pair_vs_top_line",
        "oz_usage",
        "dz_usage",
        "pinch_rules",
        "hold_line_rules"
      ],
      "description": "Guidance on D-pair deployment and risk rules, consistent with Canon pinch/hold logic."
    },
    "special_teams": {
      "fields": [
        "pp1_plan",
        "pp2_plan",
        "pk1_plan",
        "pk2_plan",
        "pp_adjustments",
        "pk_adjustments"
      ],
      "source": "SpecialTeams strategy tree",
      "description": "PP/PK plans pulled from SpecialTeams_v1.0 and adapted to opponent PK/PP style."
    },
    "goalie_plan": {
      "fields": [
        "starter",
        "backup",
        "pull_threshold",
        "fatigue_notes",
        "shot_preferences",
        "rebound_instructions"
      ],
      "description": "Who starts, when to consider a pull, and what shot types you want your shooters to chase."
    },
    "in_game_adjustments": {
      "fields": [
        "if_trailing",
        "if_leading",
        "if_cycle_dominant",
        "if_rush_dominant",
        "if_goalie_hot",
        "if_penalty_trouble"
      ],
      "description": "Clear in-game rules. Each entry sets what to change in systems/sliders if the condition happens."
    },
    "win_conditions": {
      "fields": [
        "key_to_win_1",
        "key_to_win_2",
        "key_to_win_3",
        "key_to_win_4",
        "key_to_win_5"
      ],
      "description": "Plain-language checklist for what must happen to win this specific matchup."
    }
  },
  "rules": {
    "system_selection": {
      "description": "How the engine selects Canon strategies based on opponent profile.",
      "logic": [
        "Map opponent forecheck to best Canon neutral zone + breakout counters using StrategyMap_v2.0.",
        "Map opponent cycle vs rush bias to defensive_strategy (collapsing | staggered | tight_point).",
        "If opponent has elite rush threat → bias neutral_zone to 1-3-1 or 1-2-2 blue as defined in FiveOnFive tree.",
        "If opponent has heavy cycle and net-front → bias defensive_strategy to collapsing or staggered per Canon rules."
      ]
    },
    "slider_integration": {
      "description": "How line-specific slider guidance is added without violating Canon.",
      "rules": [
        "All line slider recommendations must respect the 0–10 direction map defined in OffensiveStrategy and DefensivePressure Canon.",
        "5 is always balanced for any 0–10 slider.",
        "Gameplan can only nudge sliders within a safe band (e.g., ±2 from Canon default) unless explicitly marked as attack mode.",
        "Trap slider: 0 = full neutral zone trap, 6 = full forecheck; default = 3 unless shutdown/attack modes override."
      ]
    },
    "special_teams_link": {
      "description": "How PP/PK plans are chosen.",
      "rules": [
        "Map opponent PK (box | diamond | wedge) to PP formation using SpecialTeams tree.",
        "Map opponent PP (shooting from point vs cross-seam) to PK shape (box | diamond) and pressure rules.",
        "Prefer PP1 1-3-1 aggressive vs passive box; pivot to overload vs aggressive PK chasing high.",
        "PK must stay within Canon defensive_pressure and defensive_strategy options."
      ]
    },
    "goalie_plan_link": {
      "description": "High-level goalie logic (gameplan side).",
      "rules": [
        "If opponent is high-quality rush team → prefer calmer, positional starter if available.",
        "If B2B and fatigue is medium/high → nudge toward rotation starter.",
        "Expose goaltender weaknesses (glove | rebound | low blocker) in win_conditions and offensive game notes."
      ]
    }
  },
  "output": {
    "format": "matchup_gameplan",
    "sections_in_order": [
      "identity",
      "systems_five_on_five",
      "line_usage",
      "defense_pairs_usage",
      "special_teams",
      "goalie_plan",
      "in_game_adjustments",
      "win_conditions"
    ],
    "export_options": {
      "default_directory": "Product/Exports",
      "file_name_pattern": "Gameplan_<TEAM>_<YYYY-MM-DD>.json",
      "include_metadata": true,
      "include_opponent_profile": true
    }
  },
  "safety": {
    "canon_enforced": true,
    "reject_if": [
      "any system value not found in Canon files",
      "any slider recommendation outside 0–10 range",
      "any trap slider outside 0–6",
      "missing required sections in output schema"
    ],
    "fallback_behavior": "If something is invalid or missing, fall back to Canon defaults and clearly note the fallback in the generated gameplan."
  }
}